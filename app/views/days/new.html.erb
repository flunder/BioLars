<% content_for :graph do %>

	<% @field_data1 = [] %>
	<% @field_data2 = [] %>
	<% @field_data3 = [] %>
	<% @field_data4 = [] %>
	<% @field_data5 = [] %>		

	<% @days = Day.all %>
	<% @days.each do |day| %>
		<% @field_data1.push(day.field1, ',') %>
		<% @field_data2.push(day.field2, ',') %>
		<% @field_data3.push(day.field3, ',') %>
		<% @field_data4.push(day.field4, ',') %>
		<% @field_data5.push(day.field5, ',') %>
	<% end %>

	<canvas id="myBar" width="650" height="200">[No canvas support]</canvas>				
	<script>
        window.onload = function () {
    
            var line1 = new RGraph.Line('myBar',  [<%=@field_data1%>]);
            line1.Set('chart.colors', ['#d92d21']);
			line1.Set('chart.linewidth', 2);
			line1.Set('chart.ylabels', false);
			line1.Set('chart.background.grid.color', 'rgba(0,0,0,0)');
            line1.Draw();

			var line2 = new RGraph.Line('myBar',  [<%=@field_data2%>]);
			line2.Set('chart.colors', ['blue']);
			line2.Set('chart.linewidth', 2);
			line2.Set('chart.ylabels', false);
			line2.Set('chart.background.grid.color', 'rgba(0,0,0,0)');
			line2.Draw();

			var line3 = new RGraph.Line('myBar',  [<%=@field_data3%>]);
			line3.Set('chart.colors', ['green']);
			line3.Set('chart.linewidth', 2);
			line3.Set('chart.ylabels', false);
			line3.Set('chart.background.grid.color', 'rgba(0,0,0,0)');
			line3.Draw();
			
			var line4 = new RGraph.Line('myBar',  [<%=@field_data4%>]);
			line4.Set('chart.colors', ['green']);
			line4.Set('chart.linewidth', 2);
			line4.Set('chart.ylabels', false);
			line4.Set('chart.background.grid.color', 'rgba(0,0,0,0)');
			line4.Draw();
			
			var line5 = new RGraph.Line('myBar',  [<%=@field_data5%>]);
			line5.Set('chart.colors', ['green']);
			line5.Set('chart.linewidth', 2);
			line5.Set('chart.ylabels', false);
			line5.Set('chart.background.grid.color', 'rgba(0,0,0,0)');
			line5.Draw();						
        }
    </script>
<% end %>

<% content_for :main do %>

	<div id="leftSide">
		<h2>SOMETHING</h2>
		<img src="images/squid.png" alt="squid!">
	</div>

	<div id="rightSide">

		<h2>TODAY</h2>

		<script>
		$(document).ready(function() {
	
			$('.rater .dot').click(function(){
		
				// values
				var id = $(this).html()                                       // id = 0 / +1 / +2 etc
				var updatesID = $(this).parent('ul').attr('updates');         // day_field1
				var startValue = $('#' + updatesID).attr('value');            // previous value from field
				
				// select function
				$(this).siblings('.dot').removeClass('zero')
				$(this).addClass('zero')
		
				// update chosen
				var chosenField = $(this).siblings('.chosen')
				chosenField.html(id)
		
				if( $(this).hasClass('neg') ) { 
					chosenField.addClass('negative');
				} else { 
					chosenField.addClass('positive');	
				}

				// calculate new values
				var newValue = parseInt(startValue);
				if ( id.indexOf('+') == 0  ) { 
					id = id.replace('+', "");	
					newValue = newValue + parseInt(id);			
				} else if ( id.indexOf('-') == 0 ) {
					id = id.replace('-', "");
					newValue = newValue - parseInt(id);
				} else {}

				// update form field
				$( '#' + updatesID ).attr('value', newValue );
		
			})
		});
		</script>	

		<%= form_for @day do |f| %>

			<% if @day.errors.any? %>
			   	<% @day.errors.full_messages.each do |msg| %>
			     	<div><%= msg %></div>
				<% end %>
			<% end %>

			<div class="options">

				<% @fields = Field.all %>
				<% @lastEntry = Day.last   %>              
			    <% @lastDay = Day.find(@lastEntry.id) %>

				<div id="optionsDate"><%= Time.now.strftime("%Y-%m-%d") %></div>
	
				<% @fields.each_with_index do |field,i| %>
	
					<ul class="rater" updates='<%= "day_field#{i+1}" %>'>
						<li class="dot neg">-3</li>
						<li class="dot neg">-2</li>
						<li class="dot neg">-1</li>
						<li class="dot zero">0</li>
						<li class="dot pos">+1</li>
						<li class="dot pos">+2</li>
						<li class="dot pos">+3</li>
						<li class="chosen">-</li>
						<li class="category"><%= field.fieldName %></li>
					</ul>
	
				<% end %>
	
			</div>

		    <!--%= render 'form' %-->

		  <div class="field">
		  	  <%= f.text_field :date, :value => Time.now.strftime("%Y-%m-%d") %>
		  </div>

		  <% @fields.each_with_index do |field,i| %>
		      <% @dbField = "field#{i+1}" %>

		      <div class="field">
	
		            <%= f.label @fields[i].fieldName %><br />

				  	<% if (i == 0) %> 
				  	<%= f.text_field @dbField, :value => @lastDay.field1 %>
				  	<% end %>

				  	<% if (i == 1) %> 
				  	<%= f.text_field @dbField, :value => @lastDay.field2 %>
				  	<% end %>

					<% if (i == 2) %> 
					<%= f.text_field @dbField, :value => @lastDay.field3 %>
					<% end %>

					<% if (i == 3) %> 
					<%= f.text_field @dbField, :value => @lastDay.field4 %>
					<% end %>
			
					<% if (i == 4) %> 
					<%= f.text_field @dbField, :value => @lastDay.field5 %>
					<% end %>
			
					<% if (i == 5) %> 
					<%= f.text_field @dbField, :value => @lastDay.field6 %>
					<% end %>
					
		      </div>
		  <% end %>

		  <div class="actions">
			  <%= image_submit_tag 'submit.png', :class => 'image-submit' %>
		  </div>
	
	    <% end # form %>

	</div> 
<% end %>

<% content_for :follow do %>
	<div id="historical">
		
		<% @days = Day.all %>
		
		<div class="row">
			<span>id</span>
			<% @fields.each_with_index do |field,i| %>
  		    	<span><%= field.fieldName %></span>
			<% end %>
		</div>	
		
		<% @days.each do |day| %>
			<div class="row">
	   		    <span><%= day.id %></span>
				<span><%= day.field1 %></span>
			    <span><%= day.field2 %></span>
			    <span><%= day.field3 %></span>
			    <span><%= day.field4 %></span>
			    <span><%= day.field5 %></span>
				<span><%= day.comment %></span>
			</div>
		<% end %>
	</div>	
<% end %>	



