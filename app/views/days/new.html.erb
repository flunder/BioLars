<% content_for :graph do %>

	<% @daysToShow = Day.last(10) %>
  	<% @field_data1, @field_data2, @field_data3, @field_data4, @field_data5 = [],[],[],[],[] %>
	<% @field_data1 = @daysToShow.map{ |day| day.field1 << ',' }.to_s.chop %>
	<% @field_data2 = @daysToShow.map{ |day| day.field2 << ',' }.to_s.chop %>
	<% @field_data3 = @daysToShow.map{ |day| day.field3 << ',' }.to_s.chop %>
	<% @field_data4 = @daysToShow.map{ |day| day.field4 << ',' }.to_s.chop %>
	<% @field_data5 = @daysToShow.map{ |day| day.field5 << ',' }.to_s.chop %>

	<canvas id="myBar" width="650" height="200">[No canvas support]</canvas>				
	<script>
        window.onload = function () {
    
            var line1 = new RGraph.Line('myBar',  [<%=@field_data1%>], [<%=@field_data2%>], [<%=@field_data3%>]);
            line1.Set('chart.colors', ['red', 'blue', 'green', 'magenta', 'brown']);
			line1.Set('chart.tickmarks', ['circle','circle','circle','circle','circle']);
			line1.Set('chart.linewidth', 2);
			line1.Set('chart.ylabels', false);
			line1.Set('chart.background.grid.color', 'rgba(0,0,0,0)');
			
            line1.Draw();

        }
    </script>

<!-- These are the tooltips for the first graph. -->
<div style="display: none">
    <div id="tooltip_china"><b>China</b><br /><a href="http://www.google.com/#q=china">A populous country</a></div>
    <div id="tooltip_la"><b>Los Angeles</b><br />Home of sexy time!</div>
    <div id="tooltip_plymouth"><b>Plymouth</b><br />Plenty of surfers dude</div>

    <div id="tooltip_meadowhall"><b>Meadowhall</b><br />Shopping heaven (or hell...) here</div>
    <div id="tooltip_sydney"><b>Sydney</b><br />Home of kangeroos</div>
    <div id="tooltip_toronto"><b>Toronto</b><br />Brrrr, chilly</div>
    <div id="tooltip_france"><b>France</b><br />Ever had frogs legs?</div>
    <div id="tooltip_norway"><b>Norway</b><br />Skiing here</div>

    <div id="tooltip_sweden"><b>Sweden</b><br />Skiing here too</div>
    <div id="tooltip_spain"><b>Spain</b><br />Hola!</div>
    <div id="tooltip_deli"><b>Deli</b><br />Hot and humid here</div>
    <div id="tooltip_congo"><b>Congo</b><br />Not exactly a holiday resort</div>
    <div id="tooltip_plymouth"><b>Plymouth</b><br />Plenty of surfers here</div>

    <div id="tooltip_brazil"><b>Brazil</b><br />Fooseball</div>
    <div id="tooltip_california"><b>Califonia</b><br />"I'll be back..." And he was</div>
    <div id="tooltip_newyork"><b>New York</b><br />Home of the Friends comedy show</div>
    <div id="tooltip_paris"><b>Paris</b><br />Ever eaten frogs legs?</div>
    <div id="tooltip_uk"><b>UK</b><br />Not a place for getting sun-tans</div>

    <div id="tooltip_antartica"><b>Antartica</b><br />Surprisingly, incorporates the driest place in the world</div>
    <div id="tooltip_sahara"><b>Sahara</b><br />A questionable film, and a rather hot place</div>
    <div id="tooltip_zagreb"><b>Zagreb</b><br />Anyone know where this is...?</div>
</div>


<% end %>

<% content_for :main do %>

	<div id="leftSide">
		<h2>SOMETHING</h2>
		<img src="images/squid.png" alt="squid!">
	</div>

	<div id="rightSide">

		<h2>TODAY</h2>

		<script>
		$(document).ready(function() {
	
			$('.rater .dot').click(function(){
		
				// values
				var id = $(this).html()                                       // id = 0 / +1 / +2 etc
				var updatesID = $(this).parent('ul').attr('updates');         // day_field1
				var startValue = $('#' + updatesID).attr('value');            // previous value from field
				
				// select function
				$(this).siblings('.dot').removeClass('zero')
				$(this).addClass('zero')
		
				// update chosen
				var chosenField = $(this).siblings('.chosen')
				chosenField.html(id)
		
				if( $(this).hasClass('neg') ) { 
					chosenField.addClass('negative');
				} else { 
					chosenField.addClass('positive');	
				}

				// calculate new values
				var newValue = parseInt(startValue);
				if ( id.indexOf('+') == 0  ) { 
					id = id.replace('+', "");	
					newValue = newValue + parseInt(id);			
				} else if ( id.indexOf('-') == 0 ) {
					id = id.replace('-', "");
					newValue = newValue - parseInt(id);
				} else {}

				// update form field
				$( '#' + updatesID ).attr('value', newValue );
		
			})
		});
		</script>	

		<%= form_for @day do |f| %>

			<% if @day.errors.any? %>
			   	<% @day.errors.full_messages.each do |msg| %>
			     	<div><%= msg %></div>
				<% end %>
			<% end %>

			<div class="options">

				<% @fields = Field.all %>
				<% @lastEntry = Day.last   %>              
			    <% @lastDay = Day.find(@lastEntry.id) %>

				<div id="optionsDate"><%= Time.now.strftime("%Y-%m-%d") %></div>
	
				<% @fields.each_with_index do |field,i| %>
	
					<ul class="rater" updates='<%= "day_field#{i+1}" %>'>
						<li class="dot neg">-3</li>
						<li class="dot neg">-2</li>
						<li class="dot neg">-1</li>
						<li class="dot zero">0</li>
						<li class="dot pos">+1</li>
						<li class="dot pos">+2</li>
						<li class="dot pos">+3</li>
						<li class="chosen">-</li>
						<li class="category"><%= field.fieldName %></li>
					</ul>
	
				<% end %>
	
			</div>

		    <!--%= render 'form' %-->

		  <div class="field">
		  	  <%= f.text_field :date, :value => Time.now.strftime("%Y-%m-%d") %>
		  </div>

		  <% @fields.each_with_index do |field,i| %>
		      <% @dbField = "field#{i+1}" %>

		      <div class="field">
	
		            <%= f.label @fields[i].fieldName %><br />

				  	<% if (i == 0) %> 
				  	<%= f.text_field @dbField, :value => @lastDay.field1 %>
				  	<% end %>

				  	<% if (i == 1) %> 
				  	<%= f.text_field @dbField, :value => @lastDay.field2 %>
				  	<% end %>

					<% if (i == 2) %> 
					<%= f.text_field @dbField, :value => @lastDay.field3 %>
					<% end %>

					<% if (i == 3) %> 
					<%= f.text_field @dbField, :value => @lastDay.field4 %>
					<% end %>
			
					<% if (i == 4) %> 
					<%= f.text_field @dbField, :value => @lastDay.field5 %>
					<% end %>
			
					<% if (i == 5) %> 
					<%= f.text_field @dbField, :value => @lastDay.field6 %>
					<% end %>
					
		      </div>
		  <% end %>

		  <div class="actions">
			  <%= image_submit_tag 'submit.png', :class => 'image-submit' %>
		  </div>
	
	    <% end # form %>

	</div> 
<% end %>

<% content_for :follow do %>
	<div id="historical">
		
		<% @days = Day.all %>
		
		<div class="row">
			<span>id</span>
			<% @fields.each_with_index do |field,i| %>
  		    	<span><%= field.fieldName %></span>
			<% end %>
		</div>	
		
		<% @days.each do |day| %>
			<div class="row">
	   		    <span><%= day.id %></span>
				<span><%= day.field1 %></span>
			    <span><%= day.field2 %></span>
			    <span><%= day.field3 %></span>
			    <span><%= day.field4 %></span>
			    <span><%= day.field5 %></span>
				<span><%= day.comment %></span>
			</div>
		<% end %>
	</div>	
<% end %>	



